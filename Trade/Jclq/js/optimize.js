(function(e,t){"use strict";var n=e.$,r=e.qh360cp,i=e._,s={maxCount:500},o={sfc:{2:"\u4e3b\u8d1f",1:"\u4e3b\u80dc"},rsf:{2:"\u8ba9\u8d1f",1:"\u8ba9\u80dc"},dxf:{2:"\u5c0f\u5206",1:"\u5927\u5206"},sfd:{11:"\u5ba2\u80dc1-5",12:"\u5ba2\u80dc6-10",13:"\u5ba2\u80dc11-15",14:"\u5ba2\u80dc16-20",15:"\u5ba2\u80dc21-25",16:"\u5ba2\u80dc26+","01":"\u4e3b\u80dc1-5","02":"\u4e3b\u80dc6-10","03":"\u4e3b\u80dc11-15","04":"\u4e3b\u80dc16-20","05":"\u4e3b\u80dc21-25","06":"\u4e3b\u80dc26+"}};r.mobile.translate_name=function(e){var t=r.mobile.playType.toLowerCase(),n="";if(t=="lhh"){var e=e.split("_");n=o[e[0]][e[1]]}else n=o[t][e];return n},r.mobile.bonusCodes=function(){var e={tuoma:[],share:[]},t=r.mobile.selectGameMap;return n.each(t,function(t,n){var r=[],i=n.indexs.length;if(i){for(var s=0;s<i;s++){var o=[];o.push(t),o.push(n.indexs[s]),o.push(n.sp[s]),r.push(o.join("/"))}r=r.join(","),n.dan?e.share.push(r):e.tuoma.push(r)}}),e},r.mobile.generate_detail=function(){var e=r.mobile.bonusCodes(),t=["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"],i=n.map(n("#pick-way").find(".btn-jc-on"),function(e){return n(e).attr("type")});if(!i.length)return{};var s=e.share.length,o=[s,s],u=r.number.each_vague_share(e.tuoma,e.share,i,o),a={flag:[],info:[]},f=[],l=0;n.each(u[i[0]],function(e,t){var n=[];for(var i=0,s=t.length;i<s;i++){var o=t[i].split(",");n.push(o)}n=r.number.each_array_combo(n);for(var u=0,f=n.length;u<f;u++)a.flag.push(e);a.info=a.info.concat(n)}),n.each(a.info,function(e,n){var s={rate:0,list:[],count:1,bonus:r.mobile.price,bet:""},o=[];for(var u=0,c=n.length;u<c;u++){var h=n[u].split("/"),p=r.mobile.selectGameMap[h[0]],d=h[0].match(/^\d{8}/g)[0].replace(/(\d{4})(\d{2})(\d{2})/g,"$1/$2/$3"),v={};if(r.mobile.playType=="LHH"){var m=h[1].split("_");o.push(h[0].replace(/^\d{2}/g,"")+"-"+m[0]+"="+m[1])}else o.push(h[0].replace(/^\d{2}/g,"")+"="+h[1]);s.bonus*=h[2],v.homeTeam=p.homeTeam,v.awayTeam=p.awayTeam,v.sp=h[2],v.week=t[(new Date(d)).getDay()],v.item=h[0].replace(/^\d{8}/g,""),v.spf=r.mobile.translate_name(h[1]),s.list.push(v)}s.bet=r.mobile.playType+"|"+o.join(",")+"|"+i[0],s.bonus=r.number.format(s.bonus),s.rate=1/s.bonus,l+=s.rate,s.flag=a.flag[e],f.push(s)}),f.sort(function(e,t){return e.rate-t.rate});var c={data:f,sumRate:l};return c},r.mobile.bonus_optimize=function(e,t){var n=r.mobile.generate_detail(),i=[];switch(t){case 1:i=r.mobile.bonus_optimize_aver(n,e).sort(function(e,t){return t.rate-e.rate});break;case 2:i=r.mobile.bonus_optimize_hotCold(n,e,t).sort(function(e,t){return t.rate-e.rate});break;case 3:i=r.mobile.bonus_optimize_hotCold(n,e,t)}r.mobile.bonus_optimize_render(i,t)},r.mobile.bonus_optimize_aver=function(e,t){var n=0,r=0,i=t,s=e.sumRate,o=e.data;for(var u=0,a=o.length;u<a;u++){n=Math.floor(o[u].rate*t/s)||1,t-=n;if(t<0)break;r+=n,s-=o[u].rate,o[u].mulbonus=o[u].bonus*n,o[u].count=n}return r<i&&(o[0].count+=1,o[0].mulbonus=o[0].count*o[0].bonus),o},r.mobile.bonus_optimize_hotCold=function(e,t,i){var s=0,o=0,u=t,a=t*2,f=e.data;for(var l=0,c=f.length;l<c;l++){s=Math.ceil(a/f[l].bonus);if(t<s){r.lottery.alert("\u8be5\u65b9\u6848\u7406\u8bba\u5956\u91d1\u504f\u5c0f\uff0c\u4e0d\u652f\u6301"+(i==2?"\u535a\u70ed":"\u535a\u51b7")+"\u4f18\u5316");var h=n("#optimize-type").find(".on").attr("type");return h!=1&&r.mobile.bonus_optimize(u,1),[]}t-=s,o+=s,f[l].mulbonus=f[l].bonus*s,f[l].count=s}var p=i==2?c-1:0;return o<u&&(f[p].count+=u-o,f[p].mulbonus=f[p].count*f[p].bonus),f},r.mobile.bonus_optimize_render=function(e,t){if(e.length){var i=r.template("tmp_bonus_optimize",{data:e});n("#bonus_optimize_cont").html(i),r.mobile.optimize_cont_scroll.refresh(),r.mobile.success_optimize(t)}},r.mobile.optimize_bet_code=function(){var e=n("#bonus_optimize_cont"),t=[],i=0,s={},o=!1,u=n("#bouns"),a=u.data("count"),f=u.data("max");e.find(".bet").each(function(){var e=n(this),r=e.find(".mul").val()*1,u=e.find(".mulBonus").text()*1;if(r>0){var a=e.attr("bet");t.push(a+":"+r),i+=r;var f=a.replace(/=\d+\,?/g,"");s[f]?s[f]=Math.max(s[f],u):s[f]=u}else o=!0}),r.mobile.optimizeCode=t.join(";");var l=i*r.mobile.price,c=Math.ceil(l*r.mobile.buyPercent);n("#ownCount").text(i);var h=0;!o&&a==i?h=f:n.map(s,function(e){h+=e}),u.text(r.number.format(h)),n("#ownMoney").text(l),n("#meRG").val(c),n("#payMoney").text(c),n("#maxBD").text(l-c)},r.mobile.success_optimize=function(e){n("#optimize-type li").eq(e-1).addClass("on").siblings().removeClass("on");var t=n("#bonus_optimize_cont");t.on("change",".mul",function(){var e=n(this).parents("tr"),t=(n(this).val().replace(/\D/,"")||0)*1,i=e.find(".bonus").text();e.find(".mulBonus").text(r.number.format(t*i)),n(this).val(t),r.mobile.optimize_bet_code()}),setTimeout(function(){r.mobile.optimize_bet_code()})},r.mobile.bonus_optimize_operate=function(){var t=n("#standard"),i=n("#optimize"),o=n(".bonus-yh"),u=n(".ui-panel-dismiss"),a=n("#pick-way"),f=n("#bonus_close"),l=n("#optimize-type"),c=n("#plan_money"),h=n("#bonus_optimize_cont");a.on(r.lottery.tap,".btn-jc",function(){var e=n("#ownCount").text();t.find(".btn-jc-on").length==1&&e<=s.maxCount?i.removeClass("btn-off"):i.addClass("btn-off")}),i.on(r.lottery.tap,function(){if(n(this).hasClass("btn-off"))return!1;r.mobile.optimize_cont_scroll||(n("#optimize_cont_scroll").css("height",n("#bottom").offset().top-130),r.mobile.optimize_cont_scroll=new iScroll("optimize_cont_scroll",{hScrollbar:!1,vScrollbar:!1}),r.mobile.optimize_cont_scroll.options.onBeforeScrollStart=function(e){var t=e.explicitOriginalTarget?e.explicitOriginalTarget.nodeName.toLowerCase():e.target?e.target.nodeName.toLowerCase():"";t!="input"&&e.preventDefault()});var e=n("#ownCount").text(),t=e*2;n("#bouns").data("max",n("#bouns").text()/n("#ownMul").val()),n("#bouns").data("count",e),a.addClass("none").removeClass("pick-way-show"),u.hide(),o.removeClass("none"),n("#plan_money").val(t).data("money",t),n("#min_plan_money").text(t),r.mobile.bonus_optimize(e,1),r.mobile.buyType="optimize"}),f.on("click",function(){o.addClass("none"),a.removeClass("none"),u.hide(),r.mobile.buyType="normal",r.mobile.count()}),l.on(r.lottery.tap,"li",function(){var e=n(this).attr("type")*1,t=c.val()/2;r.mobile.bonus_optimize(t,e)}),c.on("change",function(){var e=(n(this).val().replace(/\D/,"")||0)*1;e=e%2==0?e:e+1;var t=n(this).data("money");e=e<t?t:e,n(this).val(e);var i=l.find(".on").attr("type")*1;r.mobile.bonus_optimize(e/2,i)}),h.on(r.lottery.tap,".index",function(){var t=n(this),i=n(this).parents("tr").next();i.toggleClass("none");var s=i.height();t.find("i").toggleClass("down"),r.mobile.optimize_cont_scroll.refresh();if(t.position().top+s>n(e).height()-132){var o=n("#optimize_cont_scroll").height()-45;r.mobile.optimize_cont_scroll.scrollTo(0,Math.min(o,s),0,"relative")}})},n(function(){r.mobile.bonus_optimize_operate()})})(window);